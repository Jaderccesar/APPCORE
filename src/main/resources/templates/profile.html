<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - APPCORE</title>
    <meta name="description" content="Gerencie seu perfil na plataforma APPCORE">
    <meta name="author" content="APPCORE">

    <meta property="og:title" content="Meu Perfil - APPCORE">
    <meta property="og:description" content="Gerencie seu perfil na plataforma APPCORE">
    <meta property="og:type" content="website">

    <link rel="stylesheet" href="../static/profile.css">
</head>
<body>

<header class="header">
    <div class="container header-content">
        <div class="header-left">
            <a onclick="window.location.href='home.html'" class="logo">APPCORE</a>
            <nav class="nav">
                <a onclick="window.location.href='home.html'" class="nav-link">Home</a>
                <a onclick="window.location.href='course.html'" class="nav-link">Cursos</a>
                <a onclick="window.location.href='challenge.html'" class="nav-link">Desafios</a>
                <a href="#eventos" class="nav-link">Eventos</a>
            </nav>
        </div>
        <div class="header-right">
            <button class="btn btn-ghost" onclick="handleLogout()">Sair</button>
            <button onclick="window.location.href='profile.html'" class="btn btn-icon active" title="Meu perfil">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="22" height="22">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 7.5a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.5 20.25a8.25 8.25 0 0115 0" />
                </svg>
            </button>
        </div>
    </div>
</header>

<main class="profile-main">
    <div class="container">

        <div class="profile-header">
            <div class="profile-avatar-section">
                <div class="profile-avatar" id="profileAvatar">
                    <span id="avatarInitials">UN</span>
                </div>
                <button class="btn btn-ghost btn-sm" onclick="changeAvatar()">Alterar foto</button>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarChange(event)">
            </div>
            <div class="profile-info">
                <h1 class="profile-name" id="profileName">Nome do Usu√°rio</h1>
                <p class="profile-email" id="profileEmail">usuario@email.com</p>
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="coursesCount">12</span>
                        <span class="stat-label">Cursos</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="badgesCount">8</span>
                        <span class="stat-label">Badges</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="pointsCount">2.450</span>
                        <span class="stat-label">Pontos</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="info" onclick="switchTab('info')">
                Informa√ß√µes Pessoais
            </button>
            <button class="tab-btn" data-tab="progress" onclick="switchTab('progress')">
                Progresso
            </button>
            <button class="tab-btn" data-tab="badges" onclick="switchTab('badges')">
                Badges & Conquistas
            </button>
            <button class="tab-btn" data-tab="timeline" onclick="switchTab('timeline')">
                Linha do Tempo
            </button>
        </div>

        <div class="tab-content active" id="tab-info">
            <div class="profile-grid">

                <div class="profile-card">
                    <div class="card-header">
                        <h2 class="card-title">Dados Pessoais</h2>
                        <button class="btn btn-ghost btn-sm" onclick="toggleEdit('personal')">
                            <span id="editBtnPersonal">Editar</span>
                        </button>
                    </div>
                    <form id="personalForm" class="profile-form">
                        <div class="form-group">
                            <label for="inputName">Nome Completo</label>
                            <input type="text" id="inputName" class="form-input" disabled>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="inputCPF">CPF</label>
                                <input type="text" id="inputCPF" class="form-input" disabled maxlength="14">
                            </div>
                            <div class="form-group">
                                <label for="inputBirthday">Data de Nascimento</label>
                                <input type="date" id="inputBirthday" class="form-input" disabled>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputGenero">G√™nero</label>
                            <select id="inputGenero" class="form-input" disabled>
                                <option value="">Selecione</option>
                                <option value="masculino">Masculino</option>
                                <option value="feminino">Feminino</option>
                                <option value="outro">Outro</option>
                                <option value="nao-informar">Prefiro n√£o informar</option>
                            </select>
                        </div>
                        <div class="form-actions" id="personalActions" style="display: none;">
                            <button type="button" class="btn btn-ghost" onclick="cancelEdit('personal')">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                        </div>
                    </form>
                </div>

                <div class="profile-card">
                    <div class="card-header">
                        <h2 class="card-title">Informa√ß√µes da Conta</h2>
                        <button class="btn btn-ghost btn-sm" onclick="toggleEdit('account')">
                            <span id="editBtnAccount">Editar</span>
                        </button>
                    </div>
                    <form id="accountForm" class="profile-form">
                        <div class="form-group">
                            <label for="inputEmail">E-mail</label>
                            <input type="email" id="inputEmail" class="form-input" disabled>
                        </div>
                        <div class="form-group">
                            <label for="inputAccountType">Tipo de Conta</label>
                            <select id="inputAccountType" class="form-input" disabled>
                                <option value="aluno">Aluno</option>
                                <option value="professor">Professor</option>
                                <option value="empresa">Empresa</option>
                                <option value="escola">Escola</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="inputFavLanguage">Linguagem Favorita</label>
                            <select id="inputFavLanguage" class="form-input" disabled>
                                <option value="">Selecione</option>
                                <option value="javascript">JavaScript</option>
                                <option value="python">Python</option>
                                <option value="java">Java</option>
                                <option value="csharp">C#</option>
                                <option value="php">PHP</option>
                                <option value="ruby">Ruby</option>
                                <option value="go">Go</option>
                                <option value="rust">Rust</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Status da Conta</label>
                            <div class="status-badge" id="accountStatus">Ativa</div>
                        </div>
                        <div class="form-actions" id="accountActions" style="display: none;">
                            <button type="button" class="btn btn-ghost" onclick="cancelEdit('account')">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                        </div>
                    </form>
                </div>

                <div class="profile-card">
                    <div class="card-header">
                        <h2 class="card-title">Endere√ßo</h2>
                        <button class="btn btn-ghost btn-sm" onclick="toggleEdit('address')">
                            <span id="editBtnAddress">Editar</span>
                        </button>
                    </div>
                    <form id="addressForm" class="profile-form">
                        <div class="form-group">
                            <label for="inputCEP">CEP</label>
                            <input type="text" id="inputCEP" class="form-input" disabled maxlength="9">
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 3;">
                                <label for="inputRua">Rua</label>
                                <input type="text" id="inputRua" class="form-input" disabled>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="inputNumero">N√∫mero</label>
                                <input type="text" id="inputNumero" class="form-input" disabled>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputComplemento">Complemento</label>
                            <input type="text" id="inputComplemento" class="form-input" disabled>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="inputBairro">Bairro</label>
                                <input type="text" id="inputBairro" class="form-input" disabled>
                            </div>
                            <div class="form-group">
                                <label for="inputCidade">Cidade</label>
                                <input type="text" id="inputCidade" class="form-input" disabled>
                            </div>
                        </div>
                        <div class="form-actions" id="addressActions" style="display: none;">
                            <button type="button" class="btn btn-ghost" onclick="cancelEdit('address')">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-progress">
            <div class="progress-section">
                <h2 class="section-title">Seu Progresso Geral</h2>
                <div class="progress-grid">
                    <div class="progress-card-large">
                        <div class="progress-header">
                            <h3 class="progress-title">Cursos em Andamento</h3>
                            <span class="progress-count">3 cursos</span>
                        </div>
                        <div class="course-progress-list">
                            <div class="course-progress-item">
                                <div class="course-progress-info">
                                    <h4>Fundamentos de Desenvolvimento Web</h4>
                                    <p>15 de 20 aulas conclu√≠das</p>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 75%"></div>
                                    </div>
                                    <span class="progress-percentage">75%</span>
                                </div>
                            </div>
                            <div class="course-progress-item">
                                <div class="course-progress-info">
                                    <h4>Desafios de Algoritmos</h4>
                                    <p>8 de 15 desafios resolvidos</p>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 53%"></div>
                                    </div>
                                    <span class="progress-percentage">53%</span>
                                </div>
                            </div>
                            <div class="course-progress-item">
                                <div class="course-progress-info">
                                    <h4>Automa√ß√£o de Testes para Java</h4>
                                    <p>3 de 18 aulas conclu√≠das</p>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 17%"></div>
                                    </div>
                                    <span class="progress-percentage">17%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-info">
                                <p class="stat-number">12</p>
                                <p class="stat-label">Cursos Inscritos</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚úÖ</div>
                            <div class="stat-info">
                                <p class="stat-number">5</p>
                                <p class="stat-label">Cursos Conclu√≠dos</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-info">
                                <p class="stat-number">28</p>
                                <p class="stat-label">Desafios Resolvidos</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìÖ</div>
                            <div class="stat-info">
                                <p class="stat-number">6</p>
                                <p class="stat-label">Eventos Participados</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="calendar-section">
                    <h3 class="section-subtitle">Calend√°rio de Atividades</h3>
                    <div class="upcoming-activities">
                        <div class="activity-item activity-urgent">
                            <div class="activity-date">
                                <span class="activity-day">15</span>
                                <span class="activity-month">Dez</span>
                            </div>
                            <div class="activity-info">
                                <h4>Entrega do Projeto Final</h4>
                                <p>Fundamentos de Desenvolvimento Web</p>
                                <span class="activity-time">‚è∞ Vence em 2 dias</span>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-date">
                                <span class="activity-day">20</span>
                                <span class="activity-month">Dez</span>
                            </div>
                            <div class="activity-info">
                                <h4>Hackathon de Natal</h4>
                                <p>Evento Online</p>
                                <span class="activity-time">‚è∞ Em 7 dias</span>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-date">
                                <span class="activity-day">05</span>
                                <span class="activity-month">Jan</span>
                            </div>
                            <div class="activity-info">
                                <h4>Prova de Certifica√ß√£o</h4>
                                <p>Desafios de Algoritmos</p>
                                <span class="activity-time">‚è∞ Em 23 dias</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-badges">
            <div class="badges-section">
                <h2 class="section-title">Badges & Conquistas</h2>
                <div class="badges-grid">
                    <div class="badge-card earned">
                        <div class="badge-icon">üèÜ</div>
                        <h3 class="badge-title">Primeiro Curso</h3>
                        <p class="badge-description">Complete seu primeiro curso</p>
                        <span class="badge-date">Conquistado em 15/08/2024</span>
                    </div>
                    <div class="badge-card earned">
                        <div class="badge-icon">üéØ</div>
                        <h3 class="badge-title">Desafiador</h3>
                        <p class="badge-description">Resolva 10 desafios</p>
                        <span class="badge-date">Conquistado em 22/09/2024</span>
                    </div>
                    <div class="badge-card earned">
                        <div class="badge-icon">‚ö°</div>
                        <h3 class="badge-title">Velocista</h3>
                        <p class="badge-description">Complete 5 aulas em um dia</p>
                        <span class="badge-date">Conquistado em 10/10/2024</span>
                    </div>
                    <div class="badge-card earned">
                        <div class="badge-icon">üî•</div>
                        <h3 class="badge-title">Em Chamas</h3>
                        <p class="badge-description">7 dias consecutivos estudando</p>
                        <span class="badge-date">Conquistado em 05/11/2024</span>
                    </div>
                    <div class="badge-card earned">
                        <div class="badge-icon">üí¨</div>
                        <h3 class="badge-title">Comunicador</h3>
                        <p class="badge-description">Fa√ßa 20 posts no f√≥rum</p>
                        <span class="badge-date">Conquistado em 18/11/2024</span>
                    </div>
                    <div class="badge-card earned">
                        <div class="badge-icon">üéì</div>
                        <h3 class="badge-title">Graduado</h3>
                        <p class="badge-description">Complete 5 cursos</p>
                        <span class="badge-date">Conquistado em 01/12/2024</span>
                    </div>
                    <div class="badge-card earned">
                        <div class="badge-icon">üë•</div>
                        <h3 class="badge-title">Colaborador</h3>
                        <p class="badge-description">Participe de 3 eventos</p>
                        <span class="badge-date">Conquistado em 08/12/2024</span>
                    </div>
                    <div class="badge-card earned">
                        <div class="badge-icon">‚≠ê</div>
                        <h3 class="badge-title">Estrela em Ascens√£o</h3>
                        <p class="badge-description">Alcance 2000 pontos</p>
                        <span class="badge-date">Conquistado em 12/12/2024</span>
                    </div>
                    <div class="badge-card locked">
                        <div class="badge-icon">üöÄ</div>
                        <h3 class="badge-title">Mestre dos C√≥digos</h3>
                        <p class="badge-description">Complete 10 cursos</p>
                        <span class="badge-progress">5/10 cursos</span>
                    </div>
                    <div class="badge-card locked">
                        <div class="badge-icon">üíé</div>
                        <h3 class="badge-title">Diamante</h3>
                        <p class="badge-description">Alcance 5000 pontos</p>
                        <span class="badge-progress">2450/5000 pontos</span>
                    </div>
                    <div class="badge-card locked">
                        <div class="badge-icon">üèÖ</div>
                        <h3 class="badge-title">Mentor</h3>
                        <p class="badge-description">Ajude 50 alunos no f√≥rum</p>
                        <span class="badge-progress">12/50 ajudas</span>
                    </div>
                    <div class="badge-card locked">
                        <div class="badge-icon">üéñÔ∏è</div>
                        <h3 class="badge-title">Veterano</h3>
                        <p class="badge-description">1 ano na plataforma</p>
                        <span class="badge-progress">5 meses</span>
                    </div>
                </div>

                <div class="certificates-section">
                    <h3 class="section-subtitle">Certificados</h3>
                    <div class="certificates-list">
                        <div class="certificate-item">
                            <div class="certificate-icon">üìú</div>
                            <div class="certificate-info">
                                <h4>Fundamentos de JavaScript</h4>
                                <p>Conclu√≠do em 15/08/2024 ‚Ä¢ 40 horas</p>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="downloadCertificate('js')">Download</button>
                        </div>
                        <div class="certificate-item">
                            <div class="certificate-icon">üìú</div>
                            <div class="certificate-info">
                                <h4>Python para Iniciantes</h4>
                                <p>Conclu√≠do em 22/09/2024 ‚Ä¢ 30 horas</p>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="downloadCertificate('python')">Download</button>
                        </div>
                        <div class="certificate-item">
                            <div class="certificate-icon">üìú</div>
                            <div class="certificate-info">
                                <h4>HTML & CSS Avan√ßado</h4>
                                <p>Conclu√≠do em 10/10/2024 ‚Ä¢ 25 horas</p>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="downloadCertificate('html-css')">Download</button>
                        </div>
                        <div class="certificate-item">
                            <div class="certificate-icon">üìú</div>
                            <div class="certificate-info">
                                <h4>Git & GitHub Essencial</h4>
                                <p>Conclu√≠do em 05/11/2024 ‚Ä¢ 15 horas</p>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="downloadCertificate('git')">Download</button>
                        </div>
                        <div class="certificate-item">
                            <div class="certificate-icon">üìú</div>
                            <div class="certificate-info">
                                <h4>Banco de Dados SQL</h4>
                                <p>Conclu√≠do em 01/12/2024 ‚Ä¢ 35 horas</p>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="downloadCertificate('sql')">Download</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-timeline">
            <div class="timeline-section">
                <h2 class="section-title">Linha do Tempo</h2>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker timeline-success"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">12 de Dezembro, 2024</div>
                            <h3 class="timeline-title">üéñÔ∏è Badge Conquistado: Estrela em Ascens√£o</h3>
                            <p class="timeline-description">Voc√™ alcan√ßou 2000 pontos na plataforma!</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-info"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">10 de Dezembro, 2024</div>
                            <h3 class="timeline-title">üìö Inscrito em novo curso</h3>
                            <p class="timeline-description">Automa√ß√£o de Testes para Java</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-success"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">08 de Dezembro, 2024</div>
                            <h3 class="timeline-title">üéñÔ∏è Badge Conquistado: Colaborador</h3>
                            <p class="timeline-description">Participou de 3 eventos na plataforma</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-warning"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">05 de Dezembro, 2024</div>
                            <h3 class="timeline-title">üéØ Desafio Conclu√≠do</h3>
                            <p class="timeline-description">Sistema de Login com Autentica√ß√£o - 150 pontos</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-success"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">01 de Dezembro, 2024</div>
                            <h3 class="timeline-title">üéì Curso Conclu√≠do</h3>
                            <p class="timeline-description">Banco de Dados SQL - Certificado emitido</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-info"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">25 de Novembro, 2024</div>
                            <h3 class="timeline-title">üë• Participou de evento</h3>
                            <p class="timeline-description">Workshop: Introdu√ß√£o ao DevOps</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-success"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">18 de Novembro, 2024</div>
                            <h3 class="timeline-title">üéñÔ∏è Badge Conquistado: Comunicador</h3>
                            <p class="timeline-description">Fez 20 posts no f√≥rum da comunidade</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-success"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">05 de Novembro, 2024</div>
                            <h3 class="timeline-title">üéì Curso Conclu√≠do</h3>
                            <p class="timeline-description">Git & GitHub Essencial - Certificado emitido</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-success"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">10 de Outubro, 2024</div>
                            <h3 class="timeline-title">üéì Curso Conclu√≠do</h3>
                            <p class="timeline-description">HTML & CSS Avan√ßado - Certificado emitido</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-success"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">22 de Setembro, 2024</div>
                            <h3 class="timeline-title">üéñÔ∏è Badge Conquistado: Desafiador</h3>
                            <p class="timeline-description">Resolveu 10 desafios de programa√ß√£o</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-success"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">15 de Agosto, 2024</div>
                            <h3 class="timeline-title">üéì Primeiro Curso Conclu√≠do!</h3>
                            <p class="timeline-description">Fundamentos de JavaScript - Certificado emitido</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker timeline-info"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">10 de Julho, 2024</div>
                            <h3 class="timeline-title">üéâ Bem-vindo √† APPCORE!</h3>
                            <p class="timeline-description">Conta criada com sucesso. Comece sua jornada de aprendizado!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-section">
                <h3 class="footer-title">APPCORE</h3>
                <p class="footer-text">A plataforma definitiva para aprender programa√ß√£o se divertindo.</p>
            </div>

            <div class="footer-section">
                <h4 class="footer-heading">Plataforma</h4>
                <ul class="footer-links">
                    <li><a href="#cursos">Cursos</a></li>
                    <li><a href="#desafios">Desafios</a></li>
                    <li><a href="#eventos">Eventos</a></li>
                    <li><a href="#certificados">Certificados</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

</body>

<script th:inline="javascript">
    /*<![CDATA[*/
        let userData = /*[[${user}]]*/ null;
        let currentUserId = /*[[${userId}]]*/ null;

        // Fun√ß√£o para carregar dados do usu√°rio do backend (se n√£o vier do Thymeleaf)
        async function loadUserDataFromBackend() {
            // Se j√° temos dados do Thymeleaf, usa eles
            if (userData && currentUserId) {
                loadUserData();
                return;
            }

            // Caso contr√°rio, tenta buscar via API
            try {
                const response = await fetch('/Students/current?id=' + (currentUserId || ''));

                if (!response.ok) {
                    if (response.status === 404) {
                        showNotification('Usu√°rio n√£o encontrado. Por favor, fa√ßa login.', 'error');
                        return;
                    }
                    throw new Error('Erro ao carregar dados do usu√°rio');
                }

                userData = await response.json();
                currentUserId = userData.id;

                loadUserData();
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showNotification('Erro ao carregar dados do perfil. Tente novamente.', 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadUserDataFromBackend();
            setupFormHandlers();
            setupCPFMask();
            setupCEPMask();
        });
    /*]]>*/
</script>

<script>
    function loadUserData() {
        if (!userData) {
            return;
        }

        // Dados Pessoais
        document.getElementById('inputName').value = userData.name || '';
        document.getElementById('inputCPF').value = userData.cpf || '';
        document.getElementById('inputBirthday').value = userData.birthday || '';
        // Mapear enum Gender (MALE, FEMALE, OTHER) para valores do HTML
        const generoMap = {
            'MALE': 'masculino',
            'FEMALE': 'feminino',
            'OTHER': 'outro'
        };
        document.getElementById('inputGenero').value = generoMap[userData.genero] || '';

        // Informa√ß√µes da Conta
        document.getElementById('inputEmail').value = userData.email || '';
        // Mapear enum AccountType (STUDENT, TEACHER, ENTERPRISE) para valores do HTML
        const accountTypeMap = {
            'STUDENT': 'aluno',
            'TEACHER': 'professor',
            'ENTERPRISE': 'empresa'
        };
        document.getElementById('inputAccountType').value = accountTypeMap[userData.accountType] || '';
        // Mapear enum FavoriteLanguage (PORTUGUESE, ENGLISH) para valores do HTML
        // Note: O HTML tem linguagens de programa√ß√£o, mas o enum √© de idioma
        // Por enquanto, mapeamos para valores padr√£o ou deixamos vazio
        const languageMap = {
            'PORTUGUESE': 'javascript', // Valor padr√£o
            'ENGLISH': 'javascript'
        };
        // Se o enum n√£o corresponder, deixamos o campo vazio para o usu√°rio escolher
        document.getElementById('inputFavLanguage').value = languageMap[userData.favoriteLanguage] || '';

        // Status da conta
        const statusText = userData.status === 'ACTIVE' ? 'Ativa' : 'Inativa';
        document.getElementById('accountStatus').textContent = statusText;

        // Endere√ßo (mapeando campos do modelo Address)
        if (userData.address) {
            document.getElementById('inputCEP').value = userData.address.zip || '';
            document.getElementById('inputRua').value = userData.address.street || '';
            document.getElementById('inputNumero').value = userData.address.number || '';
            document.getElementById('inputComplemento').value = userData.address.complement || '';
            // Note: Address model n√£o tem bairro, mas mantemos o campo no HTML
            document.getElementById('inputBairro').value = '';
            document.getElementById('inputCidade').value = userData.address.city || '';
            // Note: Address model tem state, mas n√£o h√° campo UF no HTML atual
            // Se necess√°rio adicionar campo UF depois
        } else {
            // Limpa campos se n√£o houver endere√ßo
            document.getElementById('inputCEP').value = '';
            document.getElementById('inputRua').value = '';
            document.getElementById('inputNumero').value = '';
            document.getElementById('inputComplemento').value = '';
            document.getElementById('inputBairro').value = '';
            document.getElementById('inputCidade').value = '';
        }

        // Atualizar header do perfil
        document.getElementById('profileName').textContent = userData.name || 'Nome do Usu√°rio';
        document.getElementById('profileEmail').textContent = userData.email || 'usuario@email.com';

        // Iniciais do avatar
        if (userData.name) {
            const initials = userData.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            document.getElementById('avatarInitials').textContent = initials;
        }

        // Estat√≠sticas (pode ser expandido depois com dados reais)
        // Por enquanto mantemos valores padr√£o ou calculados
        updateStats();
    }

    function updateStats() {
        // Estas estat√≠sticas podem ser calculadas ou buscadas do backend depois
        // Por enquanto mantemos valores padr√£o
        // document.getElementById('coursesCount').textContent = userData.coursesCount || '0';
        // document.getElementById('badgesCount').textContent = userData.badgesCount || '0';
        // document.getElementById('pointsCount').textContent = userData.totalScore || '0';
    }

    function switchTab(tabName) {

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });

        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        document.getElementById(`tab-${tabName}`).classList.add('active');
    }

    function toggleEdit(formType) {
        const form = document.getElementById(`${formType}Form`);
        const inputs = form.querySelectorAll('.form-input');
        const actions = document.getElementById(`${formType}Actions`);
        const editBtn = document.getElementById(`editBtn${capitalizeFirst(formType)}`);

        const isDisabled = inputs[0].disabled;

        inputs.forEach(input => {
            input.disabled = !isDisabled;
        });

        if (isDisabled) {
            actions.style.display = 'flex';
            editBtn.textContent = 'Cancelar';
            editBtn.parentElement.classList.add('btn-outline');
        } else {
            actions.style.display = 'none';
            editBtn.textContent = 'Editar';
            editBtn.parentElement.classList.remove('btn-outline');
        }
    }

    function cancelEdit(formType) {
        const form = document.getElementById(`${formType}Form`);
        const inputs = form.querySelectorAll('.form-input');
        const actions = document.getElementById(`${formType}Actions`);
        const editBtn = document.getElementById(`editBtn${capitalizeFirst(formType)}`);

        inputs.forEach(input => {
            input.disabled = true;
        });

        actions.style.display = 'none';
        editBtn.textContent = 'Editar';
        editBtn.parentElement.classList.remove('btn-outline');

        // Recarrega os dados originais
        loadUserData();
    }

    function capitalizeFirst(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function setupFormHandlers() {
        // Formul√°rio de Dados Pessoais
        document.getElementById('personalForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!currentUserId) {
                showNotification('Erro: ID do usu√°rio n√£o encontrado.', 'error');
                return;
            }

            // Mapear valores do HTML para enum Gender
            const generoValue = document.getElementById('inputGenero').value;
            const generoEnumMap = {
                'masculino': 'MALE',
                'feminino': 'FEMALE',
                'outro': 'OTHER'
            };

            const updatedData = {
                name: document.getElementById('inputName').value,
                cpf: document.getElementById('inputCPF').value,
                birthday: document.getElementById('inputBirthday').value,
                genero: generoEnumMap[generoValue] || generoValue.toUpperCase()
            };

            await saveUserData(currentUserId, updatedData, 'personal');
        });

        // Formul√°rio de Informa√ß√µes da Conta
        document.getElementById('accountForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!currentUserId) {
                showNotification('Erro: ID do usu√°rio n√£o encontrado.', 'error');
                return;
            }

            // Mapear valores do HTML para enums
            const accountTypeValue = document.getElementById('inputAccountType').value;
            const accountTypeEnumMap = {
                'aluno': 'STUDENT',
                'professor': 'TEACHER',
                'empresa': 'ENTERPRISE',
                'escola': 'ENTERPRISE' // escola pode mapear para ENTERPRISE ou criar enum separado
            };

            const languageValue = document.getElementById('inputFavLanguage').value;
            // Note: O enum FavoriteLanguage √© de idioma (PORTUGUESE/ENGLISH), n√£o linguagem de programa√ß√£o
            // Por enquanto, mantemos PORTUGUESE como padr√£o quando uma linguagem √© selecionada
            // Isso pode ser ajustado depois se o modelo mudar
            const languageEnumMap = {
                'javascript': 'PORTUGUESE',
                'python': 'PORTUGUESE',
                'java': 'PORTUGUESE',
                'csharp': 'PORTUGUESE',
                'php': 'PORTUGUESE',
                'ruby': 'PORTUGUESE',
                'go': 'PORTUGUESE',
                'rust': 'PORTUGUESE',
                'portuguese': 'PORTUGUESE',
                'english': 'ENGLISH'
            };

            const updatedData = {
                email: document.getElementById('inputEmail').value,
                accountType: accountTypeEnumMap[accountTypeValue] || accountTypeValue.toUpperCase(),
                favoriteLanguage: languageValue ? (languageEnumMap[languageValue] || 'PORTUGUESE') : userData.favoriteLanguage
            };

            await saveUserData(currentUserId, updatedData, 'account');
        });

        // Formul√°rio de Endere√ßo
        document.getElementById('addressForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!currentUserId) {
                showNotification('Erro: ID do usu√°rio n√£o encontrado.', 'error');
                return;
            }

            const addressData = {
                street: document.getElementById('inputRua').value,
                number: parseInt(document.getElementById('inputNumero').value) || 0,
                complement: document.getElementById('inputComplemento').value,
                city: document.getElementById('inputCidade').value,
                state: '', // Campo UF n√£o existe no HTML atual, pode ser adicionado depois
                zip: document.getElementById('inputCEP').value,
                country: 'Brasil'
            };

            const updatedData = {
                address: addressData
            };

            await saveUserData(currentUserId, updatedData, 'address');
        });
    }

    // Fun√ß√£o para salvar dados no backend
    async function saveUserData(userId, updatedData, formType) {
        try {
            // Busca o usu√°rio atual para preservar outros campos
            const currentResponse = await fetch(`/Students/${userId}`);
            if (!currentResponse.ok) {
                throw new Error('Erro ao buscar dados atuais do usu√°rio');
            }

            const currentUser = await currentResponse.json();

            // Mescla os dados atualizados com os dados atuais
            const dataToUpdate = {
                ...currentUser,
                ...updatedData
            };

            const response = await fetch(`/Students/update/${userId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dataToUpdate)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'Erro ao salvar dados');
            }

            const updatedUser = await response.json();
            userData = updatedUser;

            // Desabilita os campos novamente
            cancelEdit(formType);

            showNotification('Dados salvos com sucesso!', 'success');

            // Recarrega os dados para garantir sincroniza√ß√£o
            loadUserData();

        } catch (error) {
            console.error('Erro ao salvar:', error);
            showNotification('Erro ao salvar dados: ' + error.message, 'error');
        }
    }

    function changeAvatar() {
        document.getElementById('avatarInput').click();
    }

    function handleAvatarChange(event) {
        const file = event.target.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const avatar = document.getElementById('profileAvatar');
                avatar.style.backgroundImage = `url(${e.target.result})`;
                avatar.style.backgroundSize = 'cover';
                avatar.style.backgroundPosition = 'center';
                document.getElementById('avatarInitials').style.display = 'none';

                showNotification('Foto de perfil atualizada!', 'success');
            };
            reader.readAsDataURL(file);
        }
    }

    function handleLogout() {
        if (confirm('Tem certeza que deseja sair?')) {
            // Limpa a sess√£o no servidor
            fetch('/logout', { method: 'POST' })
                .then(() => {
                    showNotification('At√© logo!', 'info');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1500);
                })
                .catch(() => {
                    // Mesmo se der erro, redireciona
                    window.location.href = '/';
                });
        }
    }

    // Fun√ß√£o para exibir notifica√ß√µes
    function showNotification(message, type = 'info') {
        // Cria elemento de notifica√ß√£o se n√£o existir
        let notification = document.getElementById('notification');
        if (!notification) {
            notification = document.createElement('div');
            notification.id = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                transition: opacity 0.3s;
            `;
            document.body.appendChild(notification);
        }

        // Define cor baseado no tipo
        const colors = {
            success: '#10b981',
            error: '#ef4444',
            info: '#3b82f6',
            warning: '#f59e0b'
        };
        notification.style.backgroundColor = colors[type] || colors.info;
        notification.textContent = message;
        notification.style.opacity = '1';
        notification.style.display = 'block';

        // Remove ap√≥s 3 segundos
        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 300);
        }, 3000);
    }

    // Fun√ß√µes para m√°scaras de CPF e CEP
    function setupCPFMask() {
        const cpfInput = document.getElementById('inputCPF');
        if (cpfInput) {
            cpfInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                }
            });
        }
    }

    function setupCEPMask() {
        const cepInput = document.getElementById('inputCEP');
        if (cepInput) {
            cepInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 8) {
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                    e.target.value = value;
                }
            });
        }
    }

</script>

</html>
