<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking - APPCORE</title>
    <meta name="description" content="Confira o ranking dos melhores alunos da plataforma APPCORE">
    <link rel="stylesheet" href="../static/ranking.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<header class="header">
    <div class="container">
        <div class="header-content">
            <div class="header-left">
                <a onclick="window.location.href='home.html'" class="logo">APPCORE</a>
                <nav class="nav">
                    <a onclick="window.location.href='home.html'" class="nav-link">Home</a>
                    <a onclick="window.location.href='course.html'" class="nav-link">Cursos</a>
                    <a onclick="window.location.href='challenge.html'" class="nav-link">Desafios</a>
                    <a onclick="window.location.href='ranking.html'" class="nav-link active">Ranking</a>
                </nav>
            </div>
            <div class="header-right">
                <a onclick="window.location.href='user-register.html'" class="btn btn-primary">Entrar / Registrar</a>
                <button onclick="window.location.href='profile.html'" class="btn btn-icon" title="Meu perfil">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="22" height="22">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 7.5a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.5 20.25a8.25 8.25 0 0115 0" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</header>

<main>

    <section class="hero hero-small">
        <div class="container">
            <h1>üèÜ Ranking</h1>
            <p class="hero-subtitle">
                Confira a classifica√ß√£o dos melhores alunos da plataforma
            </p>
        </div>
    </section>


    <section class="section">
        <div class="container">
            <div class="podium-container">

                <div class="podium-place podium-second">
                    <div class="podium-medal">ü•à</div>
                    <div class="podium-avatar" id="avatar-2">
                        <span class="avatar-initials">--</span>
                    </div>
                    <div class="podium-rank">2¬∫</div>
                    <div class="podium-name" id="name-2">Carregando...</div>
                    <div class="podium-score" id="score-2">
                        <span class="score-value">0</span> pts
                    </div>
                    <div class="podium-stats">
                            <span class="stat-item">
                                <span class="stat-icon">üéØ</span>
                                <span id="challenges-2">0</span> desafios
                            </span>
                    </div>
                </div>

                <div class="podium-place podium-first">
                    <div class="podium-medal">ü•á</div>
                    <div class="podium-avatar podium-avatar-large" id="avatar-1">
                        <span class="avatar-initials">--</span>
                    </div>
                    <div class="podium-rank">1¬∫</div>
                    <div class="podium-name" id="name-1">Carregando...</div>
                    <div class="podium-score" id="score-1">
                        <span class="score-value">0</span> pts
                    </div>
                    <div class="podium-stats">
                            <span class="stat-item">
                                <span class="stat-icon">üéØ</span>
                                <span id="challenges-1">0</span> desafios
                            </span>
                    </div>
                </div>

                <div class="podium-place podium-third">
                    <div class="podium-medal">ü•â</div>
                    <div class="podium-avatar" id="avatar-3">
                        <span class="avatar-initials">--</span>
                    </div>
                    <div class="podium-rank">3¬∫</div>
                    <div class="podium-name" id="name-3">Carregando...</div>
                    <div class="podium-score" id="score-3">
                        <span class="score-value">0</span> pts
                    </div>
                    <div class="podium-stats">
                            <span class="stat-item">
                                <span class="stat-icon">üéØ</span>
                                <span id="challenges-3">0</span> desafios
                            </span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section section-gray">
        <div class="container">
            <div class="ranking-header">
                <h2 class="section-title">Classifica√ß√£o Geral</h2>
                <div class="ranking-filters">
                    <select id="periodFilter" class="filter-select">
                        <option value="all">Geral</option>
                        <option value="month">Este M√™s</option>
                        <option value="week">Esta Semana</option>
                    </select>
                </div>
            </div>

            <div class="ranking-list" id="rankingList">

            </div>
        </div>
    </section>
</main>

<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-section">
                <h3 class="footer-title">APPCORE</h3>
                <p class="footer-text">
                    Plataforma completa para aprendizado pr√°tico atrav√©s de cursos, desafios e eventos.
                </p>
            </div>
            <div class="footer-section">
                <h4 class="footer-heading">Plataforma</h4>
                <div class="footer-links">
                    <li><a onclick="window.location.href='course.html'">Cursos</a></li>
                    <li><a onclick="window.location.href='challenge.html'">Desafios</a></li>
                    <li><a onclick="window.location.href='ranking.html'">Ranking</a></li>
                </div>
            </div>
        </div>
    </div>
</footer>

<script>

    const SUPABASE_URL = 'https://dyidvzicuhetnyylzluz.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5aWR2emljdWhldG55eWx6bHV6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MTQ1NjMsImV4cCI6MjA3ODM5MDU2M30.DoDx6NRevvVO-dYG-fHQ0HxGJNFRHE3NFThnkhOpG-Q';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let allRankings = [];


    async function loadRankings() {
        const { data, error } = await supabase
            .from('user_scores')
            .select('*')
            .order('total_score', { ascending: false });

        if (error) {
            console.error('Erro ao carregar ranking:', error);
            return;
        }

        allRankings = data || [];
        displayPodium(allRankings);
        displayRankingList(allRankings);
    }

    function getInitials(name) {
        if (!name) return '?';
        const parts = name.split(' ');
        if (parts.length >= 2) {
            return (parts[0][0] + parts[1][0]).toUpperCase();
        }
        return name.substring(0, 2).toUpperCase();
    }

    function getAvatarColor(index) {
        const colors = [
            'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
            'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
            'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
        ];
        return colors[index % colors.length];
    }

    function displayPodium(rankings) {

        for (let i = 0; i < 3 && i < rankings.length; i++) {
            const user = rankings[i];
            const position = i + 1;

            const nameEl = document.getElementById(`name-${position}`);
            const scoreEl = document.getElementById(`score-${position}`);
            const challengesEl = document.getElementById(`challenges-${position}`);
            const avatarEl = document.getElementById(`avatar-${position}`);

            if (nameEl) nameEl.textContent = user.user_name;
            if (scoreEl) {
                scoreEl.innerHTML = `<span class="score-value">${user.total_score.toLocaleString('pt-BR')}</span> pts`;
            }
            if (challengesEl) challengesEl.textContent = user.challenges_completed || 0;
            if (avatarEl) {
                avatarEl.style.background = getAvatarColor(i);
                avatarEl.querySelector('.avatar-initials').textContent = getInitials(user.user_name);
            }
        }
    }

    function displayRankingList(rankings) {
        const listContainer = document.getElementById('rankingList');
        listContainer.innerHTML = '';

        const restOfRankings = rankings.slice(3);

        if (restOfRankings.length === 0) {
            listContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--color-gray-600);">Nenhum outro usu√°rio no ranking ainda.</p>';
            return;
        }

        restOfRankings.forEach((user, index) => {
            const position = index + 4;
            const rankingItem = document.createElement('div');
            rankingItem.className = 'ranking-item';

            rankingItem.innerHTML = `
                <div class="ranking-position">${position}¬∫</div>
                <div class="ranking-avatar" style="background: ${getAvatarColor(position - 1)}">
                    <span class="avatar-initials">${getInitials(user.user_name)}</span>
                </div>
                <div class="ranking-info">
                    <div class="ranking-name">${user.user_name}</div>
                    <div class="ranking-stats-small">
                        <span class="stat-badge">
                            <span class="stat-icon">üéØ</span>
                            ${user.challenges_completed || 0} desafios
                        </span>
                    </div>
                </div>
                <div class="ranking-score">
                    <span class="score-value">${user.total_score.toLocaleString('pt-BR')}</span>
                    <span class="score-label">pontos</span>
                </div>
            `;

            listContainer.appendChild(rankingItem);
        });
    }

    document.addEventListener('DOMContentLoaded', loadRankings);
</script>
</body>
</html>
